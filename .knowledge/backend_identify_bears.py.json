{"is_source_file": true, "format": "Python", "description": "This file is a Python script named 'identify_bears.py' designed for continuous bear detection in videos fetched from S3. It loads a YOLOv8 model, downloads videos periodically, extracts frames, performs bear detection based on confidence threshold, and logs detection details. The script emphasizes modularity, external configuration, and placeholders for cloud integrations.", "external_files": ["backend/requirements.txt", "boto3", "ultralytics", "cv2 (OpenCV)"], "external_methods": ["boto3.client", "boto3.session.Session", "YOLO (from ultralytics)", "cv2.VideoCapture", "cv2.VideoCapture.read", "cv2.CAP_PROP_FPS"], "published": ["download_video_from_s3", "load_yolo_model", "filter_and_format_detections", "write_results", "run_loop"], "classes": [], "methods": [{"name": "None _setup_logging()", "description": "Configures logging with a standard formatter and log level based on environment variable.", "scope": "", "scopeKind": ""}, {"name": "Optional[Any] _get_s3_client()", "description": "Creates an S3 client instance using boto3 and environment variables.", "scope": "", "scopeKind": ""}, {"name": "bool download_video_from_s3(bucket: str, key: str, dest_path: str)", "description": "Downloads a video file from S3 to local storage, returning success status.", "scope": "", "scopeKind": ""}, {"name": "Any load_yolo_model(model_path: str)", "description": "Loads a YOLOv8 model given a model path or name.", "scope": "", "scopeKind": ""}, {"name": "Optional[Any] _open_video_capture(video_path: str)", "description": "Opens a video file for frame extraction using OpenCV.", "scope": "", "scopeKind": ""}, {"name": "Generator[Tuple[Any,float],None,None] _frame_generator(video_path: str)", "description": "Generates frames and timestamps from a video file.", "scope": "", "scopeKind": ""}, {"name": "Any _predict(model: Any, frame: Any)", "description": "Runs inference on a single frame using the loaded model.", "scope": "", "scopeKind": ""}, {"name": "str _utc_iso_now()", "description": "Returns current UTC time as ISO 8601 string.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] filter_and_format_detections(raw_results: Any, threshold: float)", "description": "Filters raw model detections by confidence threshold and formats results.", "scope": "", "scopeKind": ""}, {"name": "None write_results(records: Iterable[Dict[str, Any]])", "description": "Handles or persists detection results; currently logs them.", "scope": "", "scopeKind": ""}, {"name": "Optional[str] _ensure_latest_video(tmp_dir: str, bucket: str, key: str)", "description": "Downloads the latest video snapshot from S3.", "scope": "", "scopeKind": ""}, {"name": "None _process_video(model: Any, video_path: str)", "description": "Processes a video file for detection and logging.", "scope": "", "scopeKind": ""}, {"name": "None run_loop( s3_bucket: str = DEFAULT_S3_BUCKET, s3_key: str = DEFAULT_S3_KEY, model_path: str = YOLO_MODEL_PATH, download_interval_sec: float = DEFAULT_DOWNLOAD_INTERVAL_SEC, idle_sleep_sec: float = DEFAULT_INFERENCE_SLEEP_SEC, )", "description": "Main loop that periodically downloads new videos and runs detection.", "scope": "", "scopeKind": ""}, {"name": "None main()", "description": "CLI entry point for starting the continuous detection process.", "scope": "", "scopeKind": ""}], "calls": ["boto3.session.Session().client", "YOLO(model_path)", "cv2.VideoCapture", "cv2.VideoCapture.read", "download_video_from_s3", "load_yolo_model", "filter_and_format_detections", "write_results", "time.sleep", "time.time", "os.path.join", "os.path.exists", "os.environ.get", "logging.getLogger"], "search-terms": ["detect_bears", "YOLOv8", "S3 video download", "video processing", "bear detection", "monitoring", "ultralytics", "boto3", "video inference", "continuous detection script"], "state": 2, "file_id": 11, "knowledge_revision": 29, "git_revision": "776c0e55987ac98245c3a7b04b1b484d6d297d85", "ctags": [{"_type": "tag", "name": "BotoCoreError", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^    BotoCoreError = ClientError = Exception  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DEFAULT_DOWNLOAD_INTERVAL_SEC", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^DEFAULT_DOWNLOAD_INTERVAL_SEC = float(os.environ.get(\"DOWNLOAD_INTERVAL_SEC\", \"30\"))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DEFAULT_INFERENCE_SLEEP_SEC", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^DEFAULT_INFERENCE_SLEEP_SEC = float(os.environ.get(\"INFERENCE_LOOP_SLEEP_SEC\", \"2\"))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DEFAULT_S3_BUCKET", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^DEFAULT_S3_BUCKET = os.environ.get(\"BEAR_S3_BUCKET\", \"identify_bear_bucket\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DEFAULT_S3_KEY", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^DEFAULT_S3_KEY = os.environ.get(\"BEAR_S3_KEY\", \"bears.mp4\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "HARDCODED_BEAR_ID", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^HARDCODED_BEAR_ID = \"011\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "PROB_THRESHOLD", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^PROB_THRESHOLD = float(os.environ.get(\"PROBABILITY_THRESHOLD\", \"0.3\"))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "YOLO", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^    YOLO = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "YOLO_MODEL_PATH", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^YOLO_MODEL_PATH = os.environ.get(\"YOLO_MODEL_PATH\", \"yolov8n.pt\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_ensure_latest_video", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _ensure_latest_video(tmp_dir: str, bucket: str, key: str) -> Optional[str]:$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(tmp_dir: str, bucket: str, key: str)"}, {"_type": "tag", "name": "_frame_generator", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _frame_generator(video_path: str) -> Generator[Tuple[Any, float], None, None]:$/", "language": "Python", "typeref": "typename:Generator[Tuple[Any,float],None,None]", "kind": "function", "signature": "(video_path: str)"}, {"_type": "tag", "name": "_get_s3_client", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _get_s3_client() -> Optional[Any]:$/", "language": "Python", "typeref": "typename:Optional[Any]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_open_video_capture", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _open_video_capture(video_path: str) -> Optional[Any]:$/", "language": "Python", "typeref": "typename:Optional[Any]", "kind": "function", "signature": "(video_path: str)"}, {"_type": "tag", "name": "_predict", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _predict(model: Any, frame: Any) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(model: Any, frame: Any)"}, {"_type": "tag", "name": "_process_video", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _process_video(model: Any, video_path: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(model: Any, video_path: str)"}, {"_type": "tag", "name": "_setup_logging", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _setup_logging() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_utc_iso_now", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def _utc_iso_now() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "boto3", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^    boto3 = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "cv2", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^    cv2 = None  # type: ignore$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "download_video_from_s3", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def download_video_from_s3(bucket: str, key: str, dest_path: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(bucket: str, key: str, dest_path: str)"}, {"_type": "tag", "name": "filter_and_format_detections", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def filter_and_format_detections(raw_results: Any, threshold: float) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(raw_results: Any, threshold: float)"}, {"_type": "tag", "name": "load_yolo_model", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def load_yolo_model(model_path: str) -> Any:$/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "(model_path: str)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^logger = logging.getLogger(\"identify_bears\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "main", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def main() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "run_loop", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def run_loop($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( s3_bucket: str = DEFAULT_S3_BUCKET, s3_key: str = DEFAULT_S3_KEY, model_path: str = YOLO_MODEL_PATH, download_interval_sec: float = DEFAULT_DOWNLOAD_INTERVAL_SEC, idle_sleep_sec: float = DEFAULT_INFERENCE_SLEEP_SEC, )"}, {"_type": "tag", "name": "write_results", "path": "/home/kavia/workspace/code-generation/bear-data-viewer-157938-157962/backend/identify_bears.py", "pattern": "/^def write_results(records: Iterable[Dict[str, Any]]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(records: Iterable[Dict[str, Any]])"}], "hash": "23f4c9f0060d0a902479ed90d1dec009", "format-version": 4, "code-base-name": "backend", "filename": "backend/identify_bears.py", "fields": [{"name": "BotoCoreError = ClientError = Exception  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DEFAULT_DOWNLOAD_INTERVAL_SEC = float(os.environ.get(\"DOWNLOAD_INTERVAL_SEC\", \"30\"))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DEFAULT_INFERENCE_SLEEP_SEC = float(os.environ.get(\"INFERENCE_LOOP_SLEEP_SEC\", \"2\"))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DEFAULT_S3_BUCKET = os.environ.get(\"BEAR_S3_BUCKET\", \"identify_bear_bucket\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DEFAULT_S3_KEY = os.environ.get(\"BEAR_S3_KEY\", \"bears.mp4\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "HARDCODED_BEAR_ID = \"011\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "PROB_THRESHOLD = float(os.environ.get(\"PROBABILITY_THRESHOLD\", \"0.3\"))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "YOLO = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "YOLO_MODEL_PATH = os.environ.get(\"YOLO_MODEL_PATH\", \"yolov8n.pt\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "boto3 = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "cv2 = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(\"identify_bears\")", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"29": "776c0e55987ac98245c3a7b04b1b484d6d297d85"}]}